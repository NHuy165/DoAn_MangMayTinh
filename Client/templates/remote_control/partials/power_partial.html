<main data-page="power">
    <div class="px-4 pt-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Shutdown -->
            <div class="p-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800">
                <div class="mb-4">
                    <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">Shutdown</h3>
                </div>
                
                <div class="flex justify-center my-8">
                    <button 
                        onclick="performShutdown()"
                        class="inline-flex items-center px-6 py-3 text-lg font-medium text-center text-white rounded-lg bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 dark:focus:ring-red-800 transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path>
                        </svg>
                        Shutdown
                    </button>
                </div>
                
                <div id="shutdownResult" class="mt-4 hidden text-sm text-center p-3 rounded-lg"></div>
            </div>

            <!-- Restart -->
            <div class="p-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800">
                <div class="mb-4">
                    <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">Restart</h3>
                </div>
                
                <div class="flex justify-center my-8">
                    <button 
                        onclick="performRestart()"
                        class="inline-flex items-center px-6 py-3 text-lg font-medium text-center text-white rounded-lg bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 dark:focus:ring-red-800 transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                        </svg>
                        Restart
                    </button>
                </div>
                
                <div id="restartResult" class="mt-4 hidden text-sm text-center p-3 rounded-lg"></div>
            </div>
        </div>
    </div>
</main>


<script>
    // Shutdown
    async function performShutdown() {
        if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën SHUTDOWN m√°y server kh√¥ng?\n\nM√°y s·∫Ω t·∫Øt ngay l·∫≠p t·ª©c!')) {
            return;
        }
        
        const result = document.getElementById('shutdownResult');
        // result.className = 'mt-4 text-sm text-center p-3 rounded';
        // result.innerHTML = 'ƒêang g·ª≠i l·ªánh shutdown...';
        // result.classList.remove('hidden');
        
        const res = await apiCall('/remote/api/power/shutdown/', 'POST');
        
        if (res.status === 'success') {
            // result.className = 'mt-4 text-sm text-center p-3 rounded bg-green-200 dark:bg-green-700 text-green-900 dark:text-green-100';
            showNotification("success", res.message || 'L·ªánh shutdown ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng');

            // === [TH√äM M·ªöI] KI·ªÇM TRA C·ªú DISCONNECT ===
            if (res.disconnected === true) {
                result.innerHTML += '<br>üîå ƒêang ng·∫Øt k·∫øt n·ªëi giao di·ªán...';
                
                // ƒê·ª£i 1.5 gi√¢y ƒë·ªÉ ng∆∞·ªùi d√πng ƒë·ªçc th√¥ng b√°o r·ªìi m·ªõi reset
                setTimeout(() => {
                    if (window.handleClientDisconnect) {
                        window.handleClientDisconnect();
                    }
                }, 1500);
            }
        } 
        
        else {
            // result.className = 'mt-4 text-sm text-center p-3 rounded bg-red-200 dark:bg-red-700 text-red-900 dark:text-red-100';
            // result.innerHTML = `‚ùå ${res.message || 'L·ªói khi g·ª≠i l·ªánh shutdown'}`;
            showNotification("error", res.message || 'L·ªói khi g·ª≠i l·ªánh shutdown');
        }
    }

    // Restart
    async function performRestart() {
        if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën RESTART m√°y server kh√¥ng?\n\nM√°y s·∫Ω kh·ªüi ƒë·ªông l·∫°i ngay l·∫≠p t·ª©c!')) {
            return;
        }
        
        const result = document.getElementById('restartResult');
        // result.className = 'mt-4 text-sm text-center p-3 rounded';
        // result.innerHTML = 'ƒêang g·ª≠i l·ªánh restart...';
        // result.classList.remove('hidden');
        
        const res = await apiCall('/remote/api/power/restart/', 'POST');
        
        if (res.status === 'success') {
            // result.className = 'mt-4 text-sm text-center p-3 rounded bg-green-200 dark:bg-green-700 text-green-900 dark:text-green-100';
            showNotification("success", res.message || 'L·ªánh restart ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng');

            // === [TH√äM M·ªöI] KI·ªÇM TRA C·ªú DISCONNECT ===
            if (res.disconnected === true) {
                result.innerHTML += '<br>üîå ƒêang ng·∫Øt k·∫øt n·ªëi giao di·ªán...';
                
                // ƒê·ª£i 1.5 gi√¢y ƒë·ªÉ ng∆∞·ªùi d√πng ƒë·ªçc th√¥ng b√°o r·ªìi m·ªõi reset
                setTimeout(() => {
                    if (window.handleClientDisconnect) {
                        window.handleClientDisconnect();
                    }
                }, 1500);
            }
        } 
        else {
            // result.className = 'mt-4 text-sm text-center p-3 rounded bg-red-200 dark:bg-red-700 text-red-900 dark:text-red-100';
            // result.innerHTML = `‚ùå ${res.message || 'L·ªói khi g·ª≠i l·ªánh restart'}`;
            showNotification("error", res.message || 'L·ªói khi g·ª≠i l·ªánh restart');
        }
    }
</script>

<script>
    // Common API call function
    async function apiCall(url, method='GET', body=null) {
        const options = { 
            method: method, 
            headers: {'Content-Type': 'application/json'} 
        };
        if (body) options.body = JSON.stringify(body);
        
        try {
            const res = await fetch(url, options);
            return await res.json();
        } catch (err) {
            console.error(err);
            return { status: 'error', message: 'Connection Error' };
        }
    }

</script>